<index-page>
  <collection: replace>
    <div class="dd">
      <ol class="dd-list">
        <treeview with="&this" />
      </ol>
    </div>
  </collection:>
</index-page>

<script>
  $('.dd').nestable({ maxDepth: 99, distance: 5 });
  $('.dd').nestable('collapseAll');
  $('.dd').on('change', function() {
    Messenger().run({
      progressMessage: '<%= t "activerecord.attribute_help.category.updating" %> ...',
      successMessage: '<%= t "activerecord.attribute_help.category.updated" %>',
      errorMessage: '<%= t "activerecord.attribute_help.category.update_failed" %>'
    },{
      url:"/admin/categories/do_treereorder",
      data: 'categories=' + JSON.stringify($('.dd').nestable('serialize')),
      dataType: 'script',
    });
  });
</script>