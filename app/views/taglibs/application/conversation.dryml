<extend tag="show-page" for="Conversation">
  <old-show-page merge>
     <append-content-body:>
      <form with="&@message" update="mymessages">
        <div> Neue Nachricht: <input:content/> </div>
      </form>

      <%= subscribe_to "/conversations/" + this.id.to_s %>

      <form id="messages-form" style="display:none;" action="refresh" update="messages">
        <input name="id" value="#{this.id}" type="hidden"/>
      </form>

      <form id="downloads-form" style="display:none;" action="refresh" update="downloads">
        <input name="id" value="#{this.id}" type="hidden"/>
      </form>

      <script>
          PrivatePub.subscribe("/conversations/<%= this.id.to_s -%>", function(data, channel) {
            $("form#" + data.type + "-form").submit();
          });
      </script>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.messages") %> </h3>
        <collection:messages part="messages"/>
      </section>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.baskets") %> </h3>
        <collection:baskets param/>
      </section>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.downloads") %> </h3>
        <collection:downloads part="downloads"/>
      </section>

   </append-content-body:>

  </old-show-page>
</extend>