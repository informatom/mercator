<extend tag="feedback-form" for="Conversation">
  <old-feedback-form merge>
    <field-list:>
      <content-view:>
        <input for="text" cols="100"/>
      </content-view:>
      <mode-label:>
        Protokoll
      </mode-label:>
      <mode-view:>
        <input type="radio" name="conversation[mode]" value="all" checked />
          Ich möchte, dass der Feedbacktext, ich und der Vertriebsberater protokolliert werden<br/>
        <input type="radio" name="conversation[mode]" value="none" checked />
          Es soll nur der Feedbacktext protokolliert werden<br/>
        <input type="radio" name="conversation[mode]" value="user" checked />
          Der Feedbacktext und ich sollen protokolliert werden<br/>
        <input type="radio" name="conversation[mode]" value="consultant" checked />
          Der Feedbacktext und der Vertriebsmitarbeiter sollen protokolliert werden<br/>
      </mode-view:>
    </field-list:>
  </old-feedback-form>
</extend>

<extend tag="show-page" for="Conversation">
  <old-show-page merge>
     <append-content-body:>
      <form with="&@message" update="mymessages">
        <div> Neue Nachricht: <input:content/> </div>
      </form>

      <%= subscribe_to "/conversations/" + this.id.to_s %>

      <form id="messages-form" style="display:none;" action="refresh" update="messages">
        <input name="id" value="#{this.id}" type="hidden"/>
      </form>

      <form id="downloads-form" style="display:none;" action="refresh" update="downloads">
        <input name="id" value="#{this.id}" type="hidden"/>
      </form>

      <script>
          PrivatePub.subscribe("/conversations/<%= this.id.to_s -%>", function(data, channel) {
            $("form#" + data.type + "-form").submit();
          });
      </script>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.messages") %> </h3>
        <collection:messages part="messages"/>
      </section>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.baskets") %> </h3>
        <collection:baskets param/>
      </section>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.downloads") %> </h3>
        <collection:downloads part="downloads"/>
      </section>

      Wir möchten unsere Beratungsqualität verbessern und bitten Sie daher um Feedback:
      <my-transition-link transition="feedback" method="get" class="btn-primary"/>

   </append-content-body:>

  </old-show-page>
</extend>