<extend tag="show-page" for="Conversation">
  <old-show-page merge>
     <append-content-body:>
      <form with="&@message" update="mymessages">
        <div> Neue Nachricht: <input:content/> </div>
      </form>

      <form id="refresh-form" style="display:none;" action="refresh" update="mymessages">
        <input name="id" value="#{this.id}" type="hidden"/>
      </form>

      <%= subscribe_to "/conversations/" + this.id.to_s %>

      <section param="collection-section" merge>
        <h3 param="collection-heading"> <%= t("attributes.messages") %> </h3>
        <do part="mymessages">
          <collection:messages />
          <script>
              PrivatePub.subscribe("/conversations/<%= this.id.to_s -%>", function(data, channel) {
                $("form#refresh-form").submit();
              });
          </script>
        </do>
      </section>

      <div class="form-horizontal">
        <section param="collection-section" merge>
          <h3 param="collection-heading"> <%= t("attributes.baskets") %> </h3>
          <collection:baskets param/>
        </section>
      </div>

      <div class="form-horizontal">
        <section param="collection-section" merge>
          <h3 param="collection-heading"> <%= t("attributes.downloads") %> </h3>
          <collection:downloads param/>
        </section>
      </div>

   </append-content-body:>

  </old-show-page>
</extend>