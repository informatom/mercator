function productsGrid() {
  $('#productsgrid').w2grid({
    name: 'productsgrid',
    multiSelect : false,
    method: 'GET',
    show: {
      toolbar: true,
      footer: true,
      toolbarSave: true
    },
    sortData: [{ field: 'number', direction: 'ASC' }],

    toolbar: {
      items: [
        { type: 'button', id: 'editProperties', img: 'fa fa-tag', disabled: true,
          caption: "<%= I18n.t('activerecord.models.property.other') %>" },
        { type: 'button', id: 'editPrices', img: 'fa fa-money', disabled: true,
          caption: "<%= I18n.t('activerecord.models.price.other') %>" },
        { type: 'button', id: 'editRelations', img: 'fa fa-arrows-h', disabled: true,
          caption: "<%= I18n.t('attributes.productrelations') %>" },
        { type: 'break' },
        { type: 'button', id: 'removeFilter', img: 'fa fa-trash',
          caption: '<%= I18n.t("attributes.filters") %> <%= I18n.t("hobo.actions.delete", model: "") %>' }
      ],
      onClick: function (target, data) {
        var selection = w2ui.productsgrid.getSelection()
        switch (target) {
        case 'editProperties':
          document.location = "/productmanager/property_manager/index/" + selection[0]
        break
        case 'editPrices':
          document.location = "/productmanager/price_manager/index/" + selection[0]
        break
        case 'editRelations':
          document.location = "/productmanager/relation_manager/index/" + selection[0]
        break
        case 'removeFilter':
          w2ui.productsgrid.searchData = null
          w2ui.productsgrid.search()
        break
        }
      }
    },

    columns: [
      { field: 'recid', caption: '<%= I18n.t("attributes.id") %>', size: '50px', sortable: true, hidden: true , attr: "align=center" },
      { field: 'number', caption: '<%= I18n.t("attributes.number") %>', size: '100px' },
      { field: 'title_de', caption: '<%= I18n.t("attributes.title") %> DE', size: '150px', sortable: true },
      { field: 'title_en', caption: '<%= I18n.t("attributes.title") %> EN', size: '150px', sortable: true, hidden: true },
      { field: 'description_de', caption: '<%= I18n.t("attributes.description") %> DE', size: '200px', sortable: true },
      { field: 'description_en', caption: '<%= I18n.t("attributes.description") %> EN', size: '200px', sortable: true, hidden: true },
      { field: 'long_description_de', caption: '<%= I18n.t("attributes.long_description") %> DE', size: '200px', sortable: true },
      { field: 'long_description_en', caption: '<%= I18n.t("attributes.long_description") %> EN', size: '200px', sortable: true, hidden: true },
      { field: 'warranty_de', caption: '<%= I18n.t("attributes.warranty") %> DE', size: '200px', sortable: true },
      { field: 'warranty_en', caption: '<%= I18n.t("attributes.warranty") %> EN', size: '200px', sortable: true, hidden: true },
      { field: 'state', caption: '<%= I18n.t("attributes.state") %>', size: '60px', sortable: true,
        editable: { type: 'list', items: [
            { id: 'new',        text: '<%= I18n.t("mercator.states.new") %>'},
            { id: 'announced',  text: '<%= I18n.t("mercator.states.announced") %>'},
            { id: 'active',     text: '<%= I18n.t("mercator.states.active") %>'},
            { id: 'deprecated', text: '<%= I18n.t("mercator.states.deprecated") %>'}
          ]
        }
      },
      { field: 'novelty', caption: '<%= I18n.t("attributes.novelty") %>', size: '50px', attr: "align=center",
        render: function (record) {
          return record.novelty ? '<icon class="fa fa-lg fa-check">' : '<icon class="fa fa-close">'
        }
      },
      { field: 'topseller', caption: '<%= I18n.t("attributes.topseller") %>', size: '50px', attr: "align=center",
        render: function (record) {
          return record.topseller ? '<icon class="fa fa-lg fa-check">' : '<icon class="fa fa-close">'
        }
      },
      { field: 'created_at', caption: '<%= I18n.t("attributes.created_at") %>', size: '130px', sortable: true, hidden: true,
        render: 'datetime:yyyy-mm-dd|hh24:mm:ss' },
      { field: 'updated_at', caption: '<%= I18n.t("attributes.updated_at") %>', size: '130px', sortable: true,
        render: 'datetime:yyyy-mm-dd|hh24:mm:ss' }
    ],

    searches: [
      { field: 'number', caption: '<%= I18n.t("attributes.number") %>', type: 'text' },
      { field: 'name_de', caption: '<%= I18n.t("attributes.name") %> DE', type: 'text' },
      { field: 'name_en', caption: '<%= I18n.t("attributes.name") %> EN', type: 'text' },
      { field: 'description_de', caption: '<%= I18n.t("attributes.description") %> DE', type: 'text' },
      { field: 'description_en', caption: '<%= I18n.t("attributes.description") %> EN', type: 'text' },
      { field: 'long_description_de', caption: '<%= I18n.t("attributes.long_description") %> DE', type: 'text' },
      { field: 'long_description_en', caption: '<%= I18n.t("attributes.long_description") %> EN', type: 'text' },
      { field: 'state', caption: '<%= I18n.t("attributes.state") %>', type: 'enum',
        options: {
          items: [
            { id: 'new',        text: '<%= I18n.t("mercator.states.new") %>'},
            { id: 'announced',  text: '<%= I18n.t("mercator.states.announced") %>'},
            { id: 'active',     text: '<%= I18n.t("mercator.states.active") %>'},
            { id: 'deprecated', text: '<%= I18n.t("mercator.states.deprecated") %>'}
          ]
        }
      }
    ],

    searchData : [{
      field : 'state', operator : 'in', type: 'enum',
      svalue: ['<%= I18n.t("mercator.states.new") %>', '<%= I18n.t("mercator.states.active") %>'],
      value : [
        { id: '<%= I18n.t("mercator.states.new") %>', text: '<%= I18n.t("mercator.states.new") %>' },
        { id: '<%= I18n.t("mercator.states.active") %>', text: '<%= I18n.t("mercator.states.active") %>' }
      ]
    }],

    onClick: function(event) {
      event.onComplete = function () {
        var selection = this.getSelection()
        if (selection.length == 1) {
          this.toolbar.enable('editProperties')
          this.toolbar.enable('editPrices')
          this.toolbar.enable('editRelations')
        } else {
          this.toolbar.disable('editProperties')
          this.toolbar.disable('editPrices')
          this.toolbar.disable('editRelations')
        }
      }
    },

    onLoad: function(event) {
      event.onComplete = function () {
        this.select(selected_product_id)
        this.toolbar.enable('editProperties')
        this.toolbar.enable('editPrices')
        this.toolbar.enable('editRelations')
        // onLoad is bit too early, according to the author, currently that's the way to go
        setTimeout(function() {
          var index = w2ui.productsgrid.get(selected_product_id, true)
          w2ui.productsgrid.scrollIntoView(index)
        }, 100)
      }
    },

    onSubmit: function(event) {
      this.url = '/productmanager/front/manage_products/' + selected_category_id
    },

    onSave: function(event) {
      this.reload()
      this.url = ""
    }
  })
}