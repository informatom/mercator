function contractitemsGrid() {
  $('#contractitemsGrid').w2grid({
    name: 'contractitemsGrid',
    multiSelect : false,
    method: 'GET',
    show: { toolbar: true, footer: true },

    toolbar: {
      items: [
        { type: 'button', id: 'newContract', img: 'fa fa-plus' },
        { type: 'button', id: 'editContract', img: 'fa fa-edit', disabled: true },
        { type: 'button', id: 'deleteContract', img: 'fa fa-trash', disabled: true },
        { type: 'button', id: 'editContractitems', img: 'fa fa-tint', disabled: true }
      ],
      onClick: function (target, data) {
        var selection = w2ui.contractitemsGrid.getSelection()
        switch (target) {
        case 'newContract':
          document.location = "/admin/contractitems/new"
        break
        case 'editContract':
          document.location = "/admin/contractitems/" + selection[0] + "/edit"
        break
        case 'editContractitems':
          document.location = "/contracting/contractitems?contract_id=" + selection[0]
        break
        case 'deleteContract':
          w2confirm(I18n.t("js.con.are_you_sure"), function (button) {
            if (button =='Yes') {
              $.ajax({
                url:"/admin/contractitems/" + selection[0],
                method: "DELETE",
                data: { authenticity_token: csrf_token },
                dataType: 'script',
              }).done(function(response, textStatus, jqXHR) {
                w2ui.contractitemsGrid.load('contractitems/manage_contractitems')
              }).fail(function(jqXHR, textStatus, errorThrown) {
                w2alert(jqXHR.responseText)
              })
            }
          })
        }
      }
    },


    columns: [
      { field: 'recid', caption: I18n.t("attributes.id"), size: '50px', hidden: true },
      { field: 'position', caption: I18n.t("attributes.position"), size: '50px', attr: "align=right", sortable: true },
      { field: 'user', caption: I18n.t("attributes.customer"), size: '200px' },
      { field: 'product_number', caption: I18n.t("attributes.product_number"), size: '50px' },
      { field: 'product_id', caption: I18n.t("attributes.id"), size: '50px' },
      { field: 'toner', caption: I18n.t("attributes.toner"), size: '50px' },
      { field: 'description_de', caption: I18n.t("attributes.description_de"), size: '200px' },
      { field: 'description_en', caption: I18n.t("attributes.description_en"), size: '200px' },
      { field: 'amount', caption: I18n.t("attributes.amount"), size: '50px' },
      { field: 'unit', caption: I18n.t("attributes.unit"), size: '50px' },
      { field: 'volume', caption: I18n.t("attributes.volume"), size: '50px' },
      { field: 'product_price', caption: I18n.t("attributes.product_price"), size: '50px', render: 'currency' },
      { field: 'vat', caption: I18n.t("attributes.vat"), size: '50px' },
      { field: 'value', caption: I18n.t("attributes.value"), size: '50px', render: 'currency' },
      { field: 'discount_abs', caption: I18n.t("attributes.discount_abs"), size: '50px', render: 'currency' },
      { field: 'term', caption: I18n.t("attributes.term"), size: '50px' },
      { field: 'startdate', caption: I18n.t("attributes.startdate"), size: '130px', sortable: true,
        render: 'date:yyyy-mm-dd' },
      { field: 'volume_bw', caption: I18n.t("attributes.volume_bw"), size: '50px' },
      { field: 'volume_color', caption: I18n.t("attributes.volume_color"), size: '50px' },
      { field: 'marge', caption: I18n.t("attributes.marge"), size: '50px', render: 'currency' },
      { field: 'monitoring_rate', caption: I18n.t("attributes.monitoring_rate"), size: '50px', render: 'currency' },
      { field: 'created_at', caption: I18n.t("attributes.created_at"), size: '130px', sortable: true,
        render: 'datetime:yyyy-mm-dd|hh24:mm:ss' },
      { field: 'updated_at', caption: I18n.t("attributes.updated_at"), size: '130px', sortable: true,
        render: 'datetime:yyyy-mm-dd|hh24:mm:ss' },
    ],

    searches: [
      { field: 'product_number', caption: I18n.t("attributes.product_number"), type: 'date' }
    ],
    sortData: [{ field: 'position', direction: 'asc' }],

    onClick: function(event) {
      event.onComplete = function () {
        var selection = this.getSelection()
        if (selection.length == 1) {
          this.toolbar.enable('editContract')
          this.toolbar.enable('editContractitems')
          this.toolbar.enable('deleteContract')
          previewImage(this.get(selection).recid)
          $.ajax({
            url:"/contentmanager/front/set_seleted_contract/" + this.get(selection).recid,
            method: "POST",
            data: { authenticity_token: csrf_token },
            dataType: 'script'
          })
        } else {
          this.toolbar.disable('editContract')
          this.toolbar.disable('editContractitems')
          this.toolbar.disable('deleteContract')
        }
      }
    },

    onLoad: function(event) {
      event.onComplete = function () {
        this.select(selected_contract_id)
        // onLoad is bit too early, according to the author, currently that's the way to go:
        setTimeout(function() {
          var index = w2ui.contractitemsGrid.get(selected_contract_id, true)
          w2ui.contractitemsGrid.scrollIntoView(index)
          w2ui.contractitemsGrid.toolbar.enable('editContract')
          w2ui.contractitemsGrid.toolbar.enable('editContractitems')
          w2ui.contractitemsGrid.toolbar.enable('deleteContract')
        }, 100)
      }
    }
  })

  w2ui.contractitemsGrid.load('contractitems/manage_contractitems?contract_id=' + request_id)
}